<!DOCTYPE html>
<html>
  <head>
    <title>4D Errors</title>
    <%include file="rotation_tables.html"/>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css"/>
    <script>
      $(document).tooltip({
        content: function () {
          return $(this).prop('title')
        }
      })
    </script>
    <script type="text/javascript" src="static/js/piechart.js"></script>
  </head>
  <%
     stringpieinfo = []
     for info in errordata['pieinfo']:
         stringpieinfo.append(str(info))
  %>
  <body onload="drawPieCharts(${','.join(stringpieinfo)});">
    <table border="3" style="border-collapse: collapse;">
      <tr>
        <th style="font-size:125%; text-align:left; padding:15px;">
          <span style="color:#0000ff;">Select a variable for the pie chart <br>(the other two make up the axes):</span>
          <form>
            <%
               pievars = {
                   'stepname' : 'Step Name',
                   'sitename' : 'Site Name',
                   'errorcode' : 'Error Code'
               }
            %>
            % for val, text in pievars.iteritems():
              <input type="radio" name="pievar" value="${val}">${text}<br>
            % endfor
            <input type="submit" value="Submit">
          </form>
        </th>

        % if errordata['pievar'] == 'sitename':
          % for col in errordata['collist']:
            <th class="rotate" title="${col['title'] | h}"><div><span>${col['name']}</span></div></th>
          % endfor
        % else:
          % for col, status in zip(errordata['collist'], readiness):
            <th class="rotate ${status}" title="${col['title'] | h}"><div><span>${col['name']}</span></div></th>
          % endfor
        % endif

      </tr>

      % for row, title_list in errordata['rowzip']:
      <tr bgcolor="${loop.cycle('#e0e0e0', '#ffffff')}">
        % if errordata['pievar'] == 'stepname':
          <th title="${row['title'] | h}">${row['name']}</th>
        % else:
          <%
             workflowstep = '/' + '/'.join(row['name'].split('<br>'))
             workflowpd = workflowstep.split('/')[1]
             if workflowpd in acted_workflows:
                 bg_type = 'done'
             else:
                 bg_type = 'todo'
          %>
          <th class="${bg_type}" title="${row['title'] | h}">
            <a href="/seeworkflow/?workflow=${workflowpd}"> <!-- #${workflowstep}"> -->
              ${row['name']}
            </a>
          </th>
        % endif

        % for index, title in enumerate(title_list):
          <th title="${title}">
            % if errordata['pievar'] == 'stepname':
              <a href="listworkflows?errorcode=${row['name'].split('>')[1].split('<')[0]}&sitename=${errordata['collist'][index]['name']}" target="blank">
            % endif
            <canvas id="canvas" width="20" height="20" class="piechart"></canvas>
            % if errordata['pievar'] == 'stepname':
              </a>
            % endif
          </th>
        % endfor
      </tr>
      % endfor
    </table>

  <a href="/resetcache">Reset Cache</a> (refresh page after coming back here)

  </body>
</html>
